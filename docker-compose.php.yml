version: '3.8'

services:
  php:
    build:
      context: docker/dockerfiles
      dockerfile: PhpDocker
      args:
        - DOCKER_USERNAME=${USERNAME}
        - DOCKER_UID=${USERID}
        - DOCKER_PHP_VERSION=${DOCKER_PHP_VERSION}
        - DOCKER_COMPOSER_VERSION=${DOCKER_COMPOSER_VERSION}
    env_file:
      - .env
    volumes:
      - ./src/PHP:/var/www
      - ./docker/php-ini:/usr/local/etc/php
      - ./docker/xdebug-ini/xdebug.ini:/usr/local/etc/php/conf.d/docker-php-ext-xdebug.ini
      - ./docker/sampler:/usr/local/etc/sampler
    container_name: ${CONTAINER_NAME_PHP}
    restart: unless-stopped
    networks:
      - DevEnvNetworkExternal
    tty: true
    stdin_open: true
    links:
      - mysql:database
    environment:
      PHP_INI_SCAN_DIR: "/usr/local/etc/php/custom.d:/usr/local/etc/php/conf.d"
    depends_on:
      - mysql

  #  nginx:
  #    build:
  #      context: docker/dockerfiles
  #      dockerfile: NginxDocker
  #      args:
  #        - DOCKER_NGINX_VERSION=${DOCKER_NGINX_VERSION}
  #    env_file:
  #      - .env
  #    container_name: ${CONTAINER_NAME_NGINX}
  #    networks:
  #      - DevEnvNetwork
  #    links:
  #      - mysql:database
  #    expose:
  #      - 443
  #    ports:
  #      - ${HOST}:${HTTP_PORT}:80
  #      - ${HOST}:${HTTPS_PORT}:443
  #    volumes:
  #      - ./docker/sites:/etc/nginx/conf.d
  #      - ./docker/ssl:/etc/ssl
  #      - ./src/PHP:/var/www
  #    depends_on:
  #      - php

  mysql:
    platform: linux/x86_64
    build:
      context: docker/dockerfiles
      dockerfile: MysqlDocker
      args:
        - DOCKER_MYSQL_VERSION=${DOCKER_MYSQL_VERSION}
    env_file:
      - .env
    container_name: ${CONTAINER_NAME_MYSQL}
    networks:
      - DevEnvNetworkExternal
    ports:
      - ${HOST}:${MYSQL_PORT}:3306
    volumes:
      - ./docker/mysql:/etc/mysql/conf.d
      - ./docker/databases:/var/databases
    restart: always
    environment:
      MYSQL_ROOT_PASSWORD: ${MYSQL_ROOT_PASSWORD}
      MYSQL_DATABASE: ${MYSQL_DEFAULT_DATABASE}
      MYSQL_USER: ${MYSQL_USER}
      MYSQL_PASSWORD: ${MYSQL_PASSWORD}

networks:
  DevEnvNetworkExternal:
    external: true
    name: DevEnvNetwork

#networks:
#  DevEnvNetwork:
#    name: DevEnvNetwork
#    driver: bridge
#    ipam:
#      driver: default
#      config:
#        - subnet: 172.29.0.0/16
